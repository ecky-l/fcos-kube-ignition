---
variant: fcos
version: 1.0.0
storage:
  files:
%{ for cfg in net_config ~}
    - path: /etc/NetworkManager/system-connections/${cfg.interface}.nmconnection
      mode: 0600
      overwrite: true
      contents:
        inline: |
          [connection]
          interface-name=${cfg.interface}
          type=ethernet
          [ethernet]
          mac-address-blacklist=
          [ipv4]
          method=${cfg.method}
          %{~ if cfg.method == "manual" ~}
          addresses=${cfg.ipnet}${ cfg.gateway != null ? format(",%s",cfg.gateway) : ""}
          %{~ if cfg.dns != null ~}
          dns=${cfg.dns}
          %{~ endif ~}
          %{~ else ~}
          %{~ if cfg.gateway == null ~}
          never-default=true
          %{~ endif ~}
          %{~ if cfg.ignore_auto_dns ~}
          ignore-auto-dns=true
          %{~ endif ~}
          %{~ endif ~}
          [ipv6]
          addr-gen-mode=stable-privacy
          dns-search=
          method=auto
          [proxy]
%{ endfor ~}
